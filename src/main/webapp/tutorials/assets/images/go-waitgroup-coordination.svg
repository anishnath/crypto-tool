<svg viewBox="0 0 900 650" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="900" height="650" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="450" y="35" font-family="Arial, sans-serif" font-size="26" font-weight="bold" fill="#2c3e50" text-anchor="middle">
    Goroutine Coordination with WaitGroup
  </text>
  
  <!-- Top: WaitGroup Lifecycle -->
  <g>
    <rect x="30" y="60" width="840" height="140" rx="8" fill="#3498DB" opacity="0.05" stroke="#3498DB" stroke-width="2"/>
    <text x="450" y="90" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#3498DB" text-anchor="middle">
      WaitGroup Lifecycle
    </text>
    
    <!-- Step 1 -->
    <rect x="60" y="105" width="180" height="80" rx="6" fill="#E8F4F8" stroke="#3498DB" stroke-width="2"/>
    <text x="150" y="125" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2c3e50" text-anchor="middle">
      1. Add
    </text>
    <text x="150" y="145" font-family="Courier New, monospace" font-size="12" fill="#555" text-anchor="middle">
      wg.Add(n)
    </text>
    <text x="150" y="165" font-family="Arial, sans-serif" font-size="11" fill="#555" text-anchor="middle">
      Increment counter
    </text>
    <text x="150" y="180" font-family="Arial, sans-serif" font-size="11" fill="#555" text-anchor="middle">
      by n goroutines
    </text>
    
    <!-- Arrow -->
    <path d="M 245 145 L 295 145" stroke="#3498DB" stroke-width="2" marker-end="url(#arrowblue)"/>
    
    <!-- Step 2 -->
    <rect x="300" y="105" width="180" height="80" rx="6" fill="#E8F5E9" stroke="#27AE60" stroke-width="2"/>
    <text x="390" y="125" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2c3e50" text-anchor="middle">
      2. Done
    </text>
    <text x="390" y="145" font-family="Courier New, monospace" font-size="12" fill="#555" text-anchor="middle">
      wg.Done()
    </text>
    <text x="390" y="165" font-family="Arial, sans-serif" font-size="11" fill="#555" text-anchor="middle">
      Decrement counter
    </text>
    <text x="390" y="180" font-family="Arial, sans-serif" font-size="11" fill="#555" text-anchor="middle">
      (call in goroutine)
    </text>
    
    <!-- Arrow -->
    <path d="M 485 145 L 535 145" stroke="#27AE60" stroke-width="2" marker-end="url(#arrowgreen)"/>
    
    <!-- Step 3 -->
    <rect x="540" y="105" width="180" height="80" rx="6" fill="#FFF3E0" stroke="#E67E22" stroke-width="2"/>
    <text x="630" y="125" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2c3e50" text-anchor="middle">
      3. Wait
    </text>
    <text x="630" y="145" font-family="Courier New, monospace" font-size="12" fill="#555" text-anchor="middle">
      wg.Wait()
    </text>
    <text x="630" y="165" font-family="Arial, sans-serif" font-size="11" fill="#555" text-anchor="middle">
      Block until
    </text>
    <text x="630" y="180" font-family="Arial, sans-serif" font-size="11" fill="#555" text-anchor="middle">
      counter = 0
    </text>
    
    <!-- Arrow markers -->
    <defs>
      <marker id="arrowblue" markerWidth="10" markerHeight="10" refX="5" refY="3" orient="auto" markerUnits="strokeWidth">
        <path d="M0,0 L0,6 L9,3 z" fill="#3498DB" />
      </marker>
      <marker id="arrowgreen" markerWidth="10" markerHeight="10" refX="5" refY="3" orient="auto" markerUnits="strokeWidth">
        <path d="M0,0 L0,6 L9,3 z" fill="#27AE60" />
      </marker>
    </defs>
  </g>
  
  <!-- Left: Worker Pool Pattern -->
  <g>
    <rect x="30" y="220" width="420" height="380" rx="8" fill="#27AE60" opacity="0.05" stroke="#27AE60" stroke-width="2"/>
    <text x="240" y="250" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#27AE60" text-anchor="middle">
      Worker Pool Pattern
    </text>
    
    <!-- Code -->
    <rect x="50" y="265" width="380" height="320" rx="6" fill="#E8F5E9"/>
    <text x="60" y="285" font-family="Courier New, monospace" font-size="11" fill="#555">
      jobs := make(chan int, 100)
    </text>
    <text x="60" y="305" font-family="Courier New, monospace" font-size="11" fill="#555">
      results := make(chan int, 100)
    </text>
    <text x="60" y="325" font-family="Courier New, monospace" font-size="11" fill="#555">
      var wg sync.WaitGroup
    </text>
    <text x="60" y="350" font-family="Courier New, monospace" font-size="11" fill="#555">
      // Start workers
    </text>
    <text x="60" y="365" font-family="Courier New, monospace" font-size="11" fill="#555">
      for i := 0; i &lt; 5; i++ {
    </text>
    <text x="60" y="380" font-family="Courier New, monospace" font-size="11" fill="#555">
        wg.Add(1)
    </text>
    <text x="60" y="395" font-family="Courier New, monospace" font-size="11" fill="#555">
        go worker(jobs, results, &amp;wg)
    </text>
    <text x="60" y="410" font-family="Courier New, monospace" font-size="11" fill="#555">
      }
    </text>
    <text x="60" y="435" font-family="Courier New, monospace" font-size="11" fill="#555">
      // Send jobs
    </text>
    <text x="60" y="450" font-family="Courier New, monospace" font-size="11" fill="#555">
      for j := 1; j &lt;= 100; j++ {
    </text>
    <text x="60" y="465" font-family="Courier New, monospace" font-size="11" fill="#555">
        jobs &lt;- j
    </text>
    <text x="60" y="480" font-family="Courier New, monospace" font-size="11" fill="#555">
      }
    </text>
    <text x="60" y="495" font-family="Courier New, monospace" font-size="11" fill="#555">
      close(jobs)
    </text>
    <text x="60" y="520" font-family="Courier New, monospace" font-size="11" fill="#555">
      // Wait for completion
    </text>
    <text x="60" y="535" font-family="Courier New, monospace" font-size="11" fill="#555">
      wg.Wait()
    </text>
    <text x="60" y="550" font-family="Courier New, monospace" font-size="11" fill="#555">
      close(results)
    </text>
    <text x="60" y="575" font-family="Arial, sans-serif" font-size="10" fill="#27AE60">
      âœ“ Fixed pool of 5 workers
    </text>
  </g>
  
  <!-- Right: Fan-Out/Fan-In Pattern -->
  <g>
    <rect x="470" y="220" width="400" height="380" rx="8" fill="#E67E22" opacity="0.05" stroke="#E67E22" stroke-width="2"/>
    <text x="670" y="250" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#E67E22" text-anchor="middle">
      Fan-Out / Fan-In Pattern
    </text>
    
    <!-- Fan-Out -->
    <rect x="490" y="265" width="360" height="140" rx="6" fill="#FFF3E0"/>
    <text x="500" y="285" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2c3e50">
      Fan-Out (Distribute Work)
    </text>
    <text x="510" y="305" font-family="Courier New, monospace" font-size="11" fill="#555">
      var wg sync.WaitGroup
    </text>
    <text x="510" y="320" font-family="Courier New, monospace" font-size="11" fill="#555">
      for _, item := range items {
    </text>
    <text x="510" y="335" font-family="Courier New, monospace" font-size="11" fill="#555">
        wg.Add(1)
    </text>
    <text x="510" y="350" font-family="Courier New, monospace" font-size="11" fill="#555">
        go func(i Item) {
    </text>
    <text x="510" y="365" font-family="Courier New, monospace" font-size="11" fill="#555">
          defer wg.Done()
    </text>
    <text x="510" y="380" font-family="Courier New, monospace" font-size="11" fill="#555">
          process(i)
    </text>
    <text x="510" y="395" font-family="Courier New, monospace" font-size="11" fill="#555">
        }(item)
    </text>
    <text x="510" y="410" font-family="Courier New, monospace" font-size="11" fill="#555">
      }
    </text>
    
    <!-- Fan-In -->
    <rect x="490" y="420" width="360" height="165" rx="6" fill="#FFF3E0"/>
    <text x="500" y="440" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2c3e50">
      Fan-In (Collect Results)
    </text>
    <text x="510" y="460" font-family="Courier New, monospace" font-size="11" fill="#555">
      results := make(chan Result)
    </text>
    <text x="510" y="480" font-family="Courier New, monospace" font-size="11" fill="#555">
      // Start collectors
    </text>
    <text x="510" y="495" font-family="Courier New, monospace" font-size="11" fill="#555">
      for i := 0; i &lt; n; i++ {
    </text>
    <text x="510" y="510" font-family="Courier New, monospace" font-size="11" fill="#555">
        wg.Add(1)
    </text>
    <text x="510" y="525" font-family="Courier New, monospace" font-size="11" fill="#555">
        go collect(results, &amp;wg)
    </text>
    <text x="510" y="540" font-family="Courier New, monospace" font-size="11" fill="#555">
      }
    </text>
    <text x="510" y="560" font-family="Courier New, monospace" font-size="11" fill="#555">
      wg.Wait()
    </text>
    <text x="510" y="575" font-family="Courier New, monospace" font-size="11" fill="#555">
      close(results)
    </text>
  </g>
  
  <!-- Watermark -->
  <text x="880" y="640" font-family="Arial, sans-serif" font-size="12" fill="#95A5A6" text-anchor="end">
    8gwifi.org/tutorials/go
  </text>
</svg>
